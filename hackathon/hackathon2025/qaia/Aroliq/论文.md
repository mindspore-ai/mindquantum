# 基于模拟分叉与梯度下降算法联合求解波束赋形问题

# 摘要

波束赋形是一种利用天线阵列定向收发数据的信号处理技术，其对应的问题即寻找一组最优的天线配置参数，使得波束满足目标条件。理想模型中的配置参数主要有一组天线阵子的相位和振幅，可视作一般的组合优化或线性规划问题。而量子启发优化算法（QAIA）是一类受到量子退火过程启发所设计的经典算法，可用于高效求解组合优化问题，模拟分叉（SB）是目前其中最先进的算法之一。

本文基于模拟分叉与梯度下降算法来联合求解波束赋形问题，相比现有研究［1]，主要贡献有两点：1．扩展相位参数的量化比特数；2．改进损失函数。初赛榜单的最高提交分数为342.8148，相比提供的基线方案高约12.2％。

# 1 问题背景与描述

如图1(a）所示，N个天线阵子等距排列在z-轴方向，每个天线阵子i具有可调整的相位 $\varphi _{i}$ 与振幅 $A_{i}$ 。其中相位 $\varphi _{i}$ 在 $[0,2\pi ]$ 之间离散取值，合法值按k-比特量化等距采样；而振幅 $A_{i}$ 连续取值，通常以1.0为参考线。

(b)

<!-- 0 (e $\frac {101g_{\max }\vert F(\ell )\vert _{F}^{2}}{\max (\ell )\vert _{F}^{2}}$ -30 $\theta _{0}-30^{\circ }$ θ。 $\theta _{0}$ $\theta _{0}+30^{\circ }$ θ $\theta$ -->

<!-- (a) $72$ N (θ,Φ) n 2 1 θ y $Φ$ x -->

图1 实验所涉及的天线阵列 $(a)$ 和对应的目标波束理想能量谱（b）

如图1(b）所示，赋形目标有三项约束：

1．在指定角度 $\theta _{0}$ 处产生一个主瓣，其峰值高出两侧旁瓣30dB，且宽度 $\leq 6^{\circ }$ ；

2．主瓣两侧 $\left[-30^{\circ },+30^{\circ }\right]$ 的内旁瓣区域比主瓣峰值低30dB；

3．其余的外旁瓣区域 $\left[-180^{\circ },-30^{\circ }\right]\cup \left[+30^{\circ },+180^{\circ }\right]$ 比主瓣峰值低15dB。

# 2 问题分析

由于相位 $\varphi _{i}$ 离散而振幅 $A_{i}$ 连续，此问题无法直接作为单纯的组合优化或线性规划问题来求解，故比赛给出的基线方案使用了两阶段优化的策略：第一阶段固定所有振幅 $A_{i}=1$ ，将一组自旋变量： $s_{i}$ 编码为相位 $\varphi _{i}$ ， $S_{i}$ i；；第二阶段固，进而用模拟分叉算法优化定优化得到的 $S_{i}$ ，用梯度下降算法优化振幅 $A_{i}$ 。此方案有两个缺陷：1．只处理了相位在1/2-比特量化下的情况，未扩展到更高量化数的情况；2．损失函数涉及欠佳，尤其在仅优化相位、不优化振幅的情况下失败概率较大。另一方面，文献［1］给出了一种将相位量化数扩展到3比特的线性映射方案，此方案的优点是线性映射计算简单，缺点是依赖十分偶然的构造技巧，无法顺其逻辑推广到更高比特数，且产生的编码序列并非严格的格雷码（Gray code)，可能导致损失函数在某些地方有较大跳变，不利于优化器的搜索过程。综上所述，我们把工作重点目标确定为两点：

1．确定一种扩展相位参数量化比特数的通用方法，且编码序列为格雷码；

2．改进损失函数，稳定优化过程，降低失败率。

# 3 方案描述

现将问题作如下形式化描述：对于每个天线阵子i，有一组自旋变量 $s_{i}\in \{+1,-1\}$ 经过相位编码函数Enc后得到该阵子的相位 $Φ_{i}\in \mathbb {C}$ ，通过 $angle$ 取得相位角 $\varphi _{i}\in [0,2\pi ]$ 6·再结合该阵子的振幅 $A_{i}$ 与目标角度 $\theta _{0}$ ，经过波束赋形函数BF算出能量谱M；损失函数loss基于能量谱M和目标角度 $\theta _{0}$ 评估损失值，可优化的变量已用红色标出。

$$\varphi _{i}=\text {angle}\left(\text {Enc}\left(s_{i}\right)\right)$$

$$\mathrm {M}=\mathrm {BF}\left(\theta _{0},\varphi _{i},A_{i}\right)$$

$$\text {min.}\text {loss}\left(\mathrm {M},\theta _{0}\right)$$

我们的两个工作重点即分别对应为相位编码Enc和损失函数loss的设计。

## 1.1 相位编码

模拟分叉算法原设计用于求解Ising模型，即 $变量取值为+1或-1的多项式函数$  ，因此无法直接用于优化相位的值（复数）或者相位角的值（实数）。必须经过一个编码过程，把 $2^{k}$ 个自旋向量映射为对应的相位或相位角，这就是相位编码过程：相位编码函数Enc 将一列共k个自旋变量s $s_{i}$ 转换为一个单位复数（ $Φ_{i}$ 

对于1-比特的情况，阵子的相位只有两种状态，容易发现取 $\text {Enc}\left(s_{1}\right)=s_{1}$ 即为一个

可行的编码函数。

<table border="1" ><tr>
<td>自旋$is$</td>
<td>相位角$\varphi _{i}$</td>
<td>相位$Φ_{i}$</td>
</tr><tr>
<td>+</td>
<td>0 </td>
<td>1 </td>
</tr><tr>
<td>-</td>
<td>π</td>
<td>-1 </td>
</tr></table>

对于2-比特的情况，则有四种状态，容易发现取Enc（ $\mathrm {c}\left(s_{1},s_{2}\right)=\frac {1+i}{2}s_{1}+\frac {1-i}{2}s_{2}$ 即可。

<table border="1" ><tr>
<td>自旋$si$</td>
<td>相位角$\varphi _{i}$</td>
<td>相位$Φ_{i}$</td>
</tr><tr>
<td>$^{++}$</td>
<td>0 </td>
<td>1 </td>
</tr><tr>
<td>-+</td>
<td>$\pi /2$</td>
<td>i1 </td>
</tr><tr>
<td></td>
<td>π</td>
<td>$-1$</td>
</tr><tr>
<td>-+</td>
<td>$3\pi /2$</td>
<td>-i </td>
</tr></table>

对于3-比特的情况，文献［1］提出了一种人工构造的线性映射（图2）。可见蓝框标出的两个位点之间存在不匀称的现象，即码值差异1个单位，但码距为2。这种不匀称现象可能会干扰优化器对于变量重要性的判断，从而使优化结果欠佳，尤其是高比特数的情况下会更复杂；较为理想的编码应该满足格雷码的性质，即码距差异正比于码值的差异。另一方面，由于自由度的约束，3-比特以上的情况无法继续用线性映射表达了，故这种做法不具备通用可扩展性。

<!-- $\text {Im}\left\{e^{jψ_{(m,n)}}\right\}$ $(1,-1,1)$ $(1,-1,-1)$ $(1,1,-1)$ $(-1,-1,-1)$ $\frac {\pi }{4}$ $(1,1,1)$ $\text {Re}\left\{e^{jψ_{(m,n)}}\right\}$ $(-1,-1,1)$ · $(-1,1,1)$ $(-1,1,-1)$ -->

图2 文献［1］提出的3-比特相位编码方法

对此，我们决定借助多层感知机（MLP）来构建通用的非线性编码函数。模型架构为经典三层MLP，即Linear( $\text {bias=True}$  )-ReLU-Linear $\text {bias=False}$  )，输入为自旋变量： $s_{i},$ ，输出为相位 $\Phi _{i}$ 的实部和虚部，建模为回归问题，使用MSELoss约束。实验表明，在3/4-比特情况下，成功训练出格雷码编码函数的最小MLP架构隐藏层宽度分别为4和6，参数量分别为24和42。对于更高比特数的情况，只需要酌情加宽隐层宽度即可。

## 1.2 损失函数

能量谱的评分项示意如图3所示，完全满足峰值-内旁瓣-外旁瓣三项约束时得满分，否则根据符合要求的程度酌情扣分直到0。

<!-- 0 $\max \left\{10\lg \frac {\vert F(\theta )\vert ^{2}}{\max \vert F(\theta )\vert ^{2}}\right\},$ $\theta \in \left[0,\theta _{0}-30^{\circ }\right)\cup \left(\theta _{0}+30^{\circ },180^{\circ }\right]$ $10\log \frac {\vert F(\theta )\vert ^{2}}{\max \vert F(\theta )\vert ^{2}}$ $\max \left\{10\lg \frac {\vert F(\theta )\vert ^{2}}{\max \vert F(\theta )\vert ^{2}}\right\},$ -30 $\theta \in \left[\theta _{0}-30^{\circ },\theta _{1}\right]\cup \left[\theta _{2},\theta _{0}+30^{\circ }\right]$ $\theta _{0}-30^{\circ }$ $\theta _{1}^{\prime }\theta _{0}\theta _{2}^{\prime }$ $\theta _{0}+30^{\circ }$ $\theta _{1}$ θ $\theta _{2}$ -->

图3 比赛评分项示意

对此我们设计了如下的损失函数，其中 $y\ _main$ 、y_inner、 $y_outer$ 分别是主瓣峰值、内旁瓣最大值、外旁瓣最大值，w,v是可调的平衡因子超参：

$$p1=(1-w)*(y_inner+1)*v$$

$$p2\;=\;(1-w)\;*\;(y\ _outer+1)$$

$$q=w*y_{main}$$

$$loss={\frac {(p1+p2)}{q}}$$

# 4 结果与分析

图4展示了我们方法的优化过程和结果，两个例子分别是：

· $目标角度=80^{\circ }$  ，相位3-比特量化，仅优化相位

· $目标角度=135^{\circ }$  （较极端），相位3-比特量化，优化相位和振幅

<!-- amp 1.04 1.02 1.00 0.98 0.96 0.0 2.5 5.0 7.5 10.0 12.5 15.0 17.5 phi 6 4 2 0.0 2.5 5.0 7.5 10.0 12.5 15.0 17.5 -->

<!-- linear 800 600 400 200 0 0 250 500 ${}^{75}\mathrm {\sim Pog}-\mathrm {scal}^{10120}$ 1250 1500 1750 0 -10 -20 -30 -40 -50 0 250 500 750 1000 1250 1500 1750 -->

<!-- amp 1.0 0.8 0.6 0.4 0.2 0 10 20 30 40 50 60 70 phi -->

<!-- 6 4 2 0 10 20 30 40 50 60 70 -->

<!-- linear 80 60 40 20 0 0 250 500 og-scaeo 1250 1500 1750 -->

<!-- 0 -10 -20 -30 -40 0 250 500 750 1000 1250 1500 1750 -->

图4我们的方法优化过程与结果

表1展示了我们的初赛提交得分。

表1 提交分数对比

<table border="1" ><tr>
<td>方法</td>
<td>提交得分</td>
</tr><tr>
<td>baseline </td>
<td>305.6669 </td>
</tr><tr>
<td>ours </td>
<td>342.8148 </td>
</tr></table>

其他讨论：

·关于两阶段优化的做法有没有可能相互穿插从而整合为one-pass：我们试过了不work，优化过程会变得很不稳定。

·关于对模拟分叉算法的改进：这个算法从原理上来说小而美，没太多改进空间，我们实现了一下batch，优化了一下程序效率。

# 5 参考文献

[1]Jiang Y,Ge H, Wang B Y, et al. Quantum-inspired Beamforming Optimization for Quantized Phase-only Massive MIMO Arrays[J].arXiv preprint arXiv:2409.19938,2024.

