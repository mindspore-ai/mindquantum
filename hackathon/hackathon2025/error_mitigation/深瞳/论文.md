---
abstract: |
  读出误差是量子计算中误差出现的重要来源之一，在硬件中，往往能达到$1\%$到$10\%$的误差，远超过单比特门和双比特门的保真度。常用的读出误差缓解方法有逆矩阵方法，IBU(Iterative
  Bayesian
  Unfolding)方法等等，这些方法本体都忽略了部分误差因素，逆矩阵方法构建全局的误差缓解矩阵，资源消耗呈指数级增长，且在采样不完美的情况下，会放大采样误差导致负概率出现；而IBU初始方法考虑单比特张量积作为误差缓解矩阵，忽略了串扰等因素。QuFEM基于有限元方法对量子规模和串扰关联问题作出平衡，该方法将量子比特分割成子量子比特集合，由子系统张量积来构建误差缓解矩阵。本文部分复现了QuFEM方法，在迭代部分进行了些许改变，相比逆矩阵方法仍然能带来一定的提升，在随机电路上提升较小，但在GHZ态制备电路上的提升相对较大。
bibliography:
- ref.bib
nocite: "[@*]"
title: 2025量子计算黑客松决赛论文------读出误差缓解赛道
---

::: center
深瞳 中国科学院数学与系统科学研究院
:::

# 问题背景

在超导量子计算中，读出误差率一般在 $1 \%$ 到 $10 \%$
，是量子错误的一个重要来源，其原因在于测量需要系统与设备耦合，导致易受能级泄露、串扰（crosstalk）及环境噪声影响
。读出误差可以通过硬件优化的方式来降低，也可以从算法的角度直接对当前硬件进行误差缓解。当前处理读出噪声的优化技术有基于矩阵[@Nachman:2019zfw]、机器学习、贝叶斯估计[@Nachman:2019zfw]的矫正方法等。

基于矩阵的方法和贝叶斯估计需要先构建误差缓解矩阵来实现误差的表征，第二步需要进行矩阵向量乘法来还原理想输出。为了更精确地进行矩阵表征，往往需要指数级的电路消耗，以及大量的采样，这大大降低了其可扩展性。因此更好的算法可以以降低采样精度为代价来提高可扩展性，并且在有限采样下，尝试提高性能。

# 问题分析

基于矩阵的方法，对于$n$比特系统，构建全局读出误差矩阵需要$2^n$个基准电路，每个电路通过$N$次采样以$O(\frac{1}{\sqrt{N}})$的精度得到真实测量结果：
$$\Vec{i} \rightarrow  \sum_{j} M_{ij} \Vec{j}$$

表示理想电路测量为$\Vec{i}$，实际测量为一个概率叠加，以概率$M_{ij}$得到$\Vec{j}$，从而得到全局测量矩阵为$M^T$。假设理想电路测量分布为$\rho_{ideal}$，而含噪测量为$\rho_{noise}$，则在不考虑采样精度的情况下有
$$\rho_{ideal} = (M^T)^{-1}*\rho_{noise}$$
对于全局误差缓解，需要指数级基准电路，并且考虑到采样误差，矩阵逆可能会将采样误差放大，导致出现负概率，影响该方法的保真度，这与矩阵条件数有关。为了避免负概率，文献[@IBU]采用贝叶斯迭代展开的方式，从先验分布开始，逐步迭代产生后验分布来逼近理想分布。由于IBU方法运行时间过长，本文没有对其过多测试，此处不作展开。

为了平衡串扰关联因素和资源消耗，文献[@QuFEM]基于有限元方法，将$n$个比特分为$K$组，使得组内关联大，而组间关联小，来缓解串扰的影响，同时减少资源消耗。本文部分用QuFEM的思想来构建赛题的解决方案。在文章的最后附上了所有部分的代码。

 

# 方案描述

## 分组

第一步需要将$n$(本文为9)个比特分成$K$个比特组。首先需要构建比特之间的关联图，按照QuFEM[@QuFEM]的方法，
$$\label{eqn:1}
\begin{aligned} 
interact (q_i.ideal =x \rightarrow q_j.ideal =y)= \\
|p\left(q_j .e f=1 \mid C 1, C 2\right)-p\left(q_j.e f=1 \mid C 2\right)| \\
C 1: q_{i} . \text { ideal }=x, C 2: q_{j} . \text { ideal }=y,
\end{aligned}$$ 公式([\[eqn:1\]](#eqn:1){reference-type="ref"
reference="eqn:1"})表示当第$i$个比特制备为$x$时，对$j$理想态为$y$时的影响，由于$x,y$的取值为$0,1$，因此$x,y$之间的关联共有8项，为如下定义：
$$\label{eqn:2}
\begin{aligned} 
weight (q_i, q_j)= \sum_{x,y}interact (q_i.ideal =x \rightarrow q_j.ideal =y)+   \\
 \sum_{x,y}interact (q_j.ideal =x \rightarrow q_i.ideal =y)+ 
\end{aligned}$$ 代码如下： 求比特间关联

``` {.python language="python"}
```

关于权重所需要的采样数，不需要特别高的精度，否则效率大大降低，在$2^n$个基准电路中，我随机选取其中$n*6$个作为权重采样电路，每个电路采样$2^7$，从而消耗几乎可以忽略。

将权重weight作为边，比特作为点，构成一个加权图，在实验上，当比特数小于5时，全局矩阵精度更高，因此本文将9个点平均分为3组，由于比特数不大，为了稳定得到结果，最终的结果里采用类似穷举的方法，也可以直接用一些贪心算法，差别不是很大。
求最佳分割

``` {.python language="python"}
```

        

## 局部测量矩阵

得到最佳分割后，对每个子系统构建测量矩阵。假定全局矩阵方法对每个电路的采样次数为$N$，则精度为$O(\frac{1}{\sqrt{N}}) = O(\epsilon)$，假设每个比特组有$n_i$个比特，且张量积之间的精度是近似加性的，即$M_1\otimes M_2$的精度为$O(\epsilon_1 + \epsilon_2)$，则每个比特组的采样精度应为$O(\epsilon \frac{n_i}{n})$，故其采样量为$N * \frac{n^2}{n_i^2}$，但是题目是由$2^n$个基准线路测量得到结果，而每个比特组仅需其中$n_i$个比特的结果，这会导致有$2^{n-n_i}$的采样重复，外加一共$2^n$基准电路，故按照原代码的框架，实际采样量为$N_i$
$$N_i = N*\frac{n^2}{n_i^2} * 2^{n_i - n} * 2^n$$
而每一次电路采样只需要测量$n_i$个比特，因此总的采样资源为：
$$N' = N*n^2*\sum_i\frac{2^{n_i-n}  }{n_i^2} * n_i * 2^n$$
当$K = 1$时，就是全局矩阵的采样资源。假设$K = \sqrt{n}$，则$N' = N*n^2 * 2^{\sqrt{n}}$，相比于原来的$N*n*2^n$大大减少。
至此我们得到了一种分割下的测量矩阵构建。

## 迭代

在QuFEM中，我们可以设置迭代次数，进行多次分组，来更详尽地描述比特之间的串扰，在每一次分完组后，需要对基准电路也进行误差缓解来构建新的基准电路输出，在新的基准电路上再次进行分组，构建新一轮误差缓解矩阵来不断地消除串扰噪声。但是在个人的实验上并没有明显的提升，且迭代超过3次后效果反而变差，个人认为原因如下：

-   采样误差：由于有采样误差存在，在第一次做完误差缓解后，由采样误差所导致的误差会进一步放大，从而导致第二次由新的基准矩阵构建缓解矩阵时偏差变大，这种偏差的影响如果大于考虑新的串扰所带来的收益便会使效果变差，尤其在比特数较少下，一次分组已经有比较好的表现。

## 修正

在上一小节中，讨论了个人按照原论文实现时的问题，由于在基准电路上进行误差缓解可能会放大采样的误差，因此是否可以不改变基准电路来进行迭代。一个测量矩阵$M$形式上可按以下方式分解：
$$M = \widetilde{ \otimes_{k=1}^KM_k} + \sum_{i<j}\delta_{ij} + \sum_{i<j<k}\delta_{i,j,k}...$$
其中$\delta$项表示子系统之间的串扰项，$\widetilde{A}$表示近似与$A$的项，使得$M$仍然满足概率矩阵的性质。当考虑不同且不相交的分组时，即两种分组$K_1,K_2$中任选两个子系统$k_1,k_2$，其交集只有一个比特，此时其两项和三项的串扰项覆盖的比特是不重复的.
$$M_1 = \widetilde{ \otimes_{k=1}^KM_k} + \sum_{(i,j)\in C_1}\delta_{ij} + \sum_{(i,j,k)\in D_1}\delta_{i,j,k}...$$
$$M_2 = \widetilde{ \otimes_{k=1}^KM_k} + \sum_{(i,j)\in C_2}\delta_{ij} + \sum_{(i,j,k)\in D_2}\delta_{i,j,k}...$$
但是由于非串扰项已经被缓解过一次，因此第二个误差缓解矩阵需要部分修正，使得对角线元素增大，而非对角线元素减小,近似得到
$$M_2' = \widetilde{I_K} + \sum_{(i,j)\in C_2}\delta_{ij} + \sum_{(i,j,k)\in D_2}\delta_{i,j,k}...$$
本文我对非对角线元素乘了一个因子$\frac{1}{2^{d-1}}$，$d$表示迭代的轮次。而对角线进行归一化即可。
因子修正

``` {.python language="python"}
```

## 其他修正

如问题分析中所展示，测量矩阵为$M^T$，而原代码中用的是$M$本身，因此需要直接进行修改。

对于负概率出现，直接将负概率赋予0即可，在我们的矩阵逆过程中，不是把张量积作为整体求逆，而是每一个子系统分别求逆后作张量积，会省计算资源。

对于正的数也设置了剪枝，当概率$p<\frac{2}{50000}$时，将概率赋予0，这个界与得到6个测试电路所用的采样数相关。

# 结果

在这个部分，我们用表格形式展示我们的结果。其中包括原代码全局逆的结果，单比特张量积结果和我们的结果。在实验设置上，取$N = 2^ {13}$，并且矩阵转置部分已经做了修正。

::: table*
:::

可以发现，我们的方法无论是对随机电路还是GHZ电路均有提升，并且在采样量上也具有优势。在实验上我们进行了两次以上的分组，但是效果会逐渐下降，多次迭代下的模型应该更为复杂，不能简单地进行近似处理。

 

# 总结及展望

文中主要用了QuFEM[@QuFEM]的思想，在迭代部分做了部分修改，得到了较好的改进。但是迭代部分的修改没有进行理论说明，这点可以进一步研究。

由于采样误差导致的错误是否能够更好地进行修正，例如假设采样误差是与采样量相关的高斯分布，从高斯分布的性质出发结合误差缓解矩阵来构建理想态的估计量也是可以尝试研究的。

 

 

 

 

 

 

 

 

 
